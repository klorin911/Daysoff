@page "/schedule"
@rendermode InteractiveServer
@using System.ComponentModel.DataAnnotations
@using System.Globalization
@using DaysOff.Models
@using DaysOff.Services
@inject ScheduleService ScheduleService
@inject AuthService Auth

<PageTitle>Schedule Selection</PageTitle>

@if (_isMonthPickerOpen || _openPicker is not null)
{
    <button type="button" class="picker-backdrop" @onclick="CloseAllPickers" aria-hidden="true"></button>
}

<div class="selection-section">
    <div class="selection-header">
        <h2>Schedule Selection</h2>
        <p>Select your schedule, shift, and start month to preview the year ahead.</p>
    </div>
    
    <div class="selection-card">
        <div class="selection-fields">
            <div class="selection-field">
                <label class="form-label" for="schedule-type">Schedule</label>
                <div class="month-picker">
                    <button id="schedule-type"
                            type="button"
                            class="form-control month-picker__toggle @(IsPickerOpen(SchedulePicker) ? "is-open" : "")"
                            @onclick="() => TogglePicker(SchedulePicker)"
                            aria-haspopup="dialog"
                            aria-expanded="@IsPickerOpen(SchedulePicker)"
                            aria-controls="schedule-panel">
                        <span>@GetScheduleLabel(_selection.ScheduleType)</span>
                        <span class="month-picker__chevron" aria-hidden="true">▾</span>
                    </button>
                    @if (IsPickerOpen(SchedulePicker))
                    {
                        <div id="schedule-panel" class="month-picker__panel month-picker__panel--list month-picker__panel--attached" role="dialog" aria-label="Choose schedule">
                            <div class="month-picker__grid month-picker__grid--list">
                                @foreach (var option in _scheduleOptions)
                                {
                                    var isSelected = _selection.ScheduleType == option.Value;
                                    <button type="button"
                                            class="month-picker__month @(isSelected ? "is-selected" : "")"
                                            @onclick="() => SelectSchedule(option.Value)"
                                            aria-label="@option.Label">
                                        @option.Label
                                    </button>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
            
            <div class="selection-field">
                <label class="form-label" for="shift-type">Shift</label>
                <div class="month-picker">
                    <button id="shift-type"
                            type="button"
                            class="form-control month-picker__toggle @(IsPickerOpen(ShiftPicker) ? "is-open" : "")"
                            @onclick="() => TogglePicker(ShiftPicker)"
                            aria-haspopup="dialog"
                            aria-expanded="@IsPickerOpen(ShiftPicker)"
                            aria-controls="shift-panel">
                        <span>@GetShiftLabel(_selection.ShiftType)</span>
                        <span class="month-picker__chevron" aria-hidden="true">▾</span>
                    </button>
                    @if (IsPickerOpen(ShiftPicker))
                    {
                        <div id="shift-panel" class="month-picker__panel month-picker__panel--list month-picker__panel--attached" role="dialog" aria-label="Choose shift">
                            <div class="month-picker__grid month-picker__grid--list">
                                @foreach (var option in _shiftOptions)
                                {
                                    var isSelected = _selection.ShiftType == option.Value;
                                    <button type="button"
                                            class="month-picker__month @(isSelected ? "is-selected" : "")"
                                            @onclick="() => SelectShift(option.Value)"
                                            aria-label="@option.Label">
                                        @option.Label
                                    </button>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
            
            <div class="selection-field">
                <label class="form-label" for="start-month">Start Month</label>
                <div class="month-picker">
                    <button id="start-month"
                            type="button"
                            class="form-control month-picker__toggle @(_isMonthPickerOpen ? "is-open" : "")"
                            @onclick="ToggleMonthPicker"
                            aria-haspopup="dialog"
                            aria-expanded="@_isMonthPickerOpen"
                            aria-controls="start-month-panel">
                        <span>@_selection.StartMonth.ToString("MMMM yyyy")</span>
                        <span class="month-picker__chevron" aria-hidden="true">▾</span>
                    </button>
                    @if (_isMonthPickerOpen)
                    {
                        <div id="start-month-panel" class="month-picker__panel month-picker__panel--attached" role="dialog" aria-label="Choose start month">
                            <div class="month-picker__header">
                                <button type="button" class="month-picker__nav" @onclick="() => ChangeYear(-1)" aria-label="Previous year">‹</button>
                                <div class="month-picker__year">@_visibleYear</div>
                                <button type="button" class="month-picker__nav" @onclick="() => ChangeYear(1)" aria-label="Next year">›</button>
                            </div>
                            <div class="month-picker__grid">
                                @for (var i = 0; i < 12; i++)
                                {
                                    var month = i + 1;
                                    var isSelected = _selection.StartMonth.Year == _visibleYear && _selection.StartMonth.Month == month;
                                    <button type="button"
                                            class="month-picker__month @(isSelected ? "is-selected" : "")"
                                            @onclick="() => SelectMonth(month)"
                                            aria-label="@_monthFullNames[i]">
                                        @_monthShortNames[i]
                                    </button>
                                }
                            </div>
                            <div class="month-picker__footer">
                                <button type="button" class="month-picker__action" @onclick="SelectThisMonth">This month</button>
                            </div>
                        </div>
                    }
                </div>
            </div>

            @if (_selection.ScheduleType == ScheduleType.PlatoonTen)
            {
                <div class="selection-field">
                    <label class="form-label" for="platoon-days">Days Off</label>
                    <div class="month-picker">
                        <button id="platoon-days"
                                type="button"
                                class="form-control month-picker__toggle @(IsPickerOpen(PlatoonPicker) ? "is-open" : "")"
                                @onclick="() => TogglePicker(PlatoonPicker)"
                                aria-haspopup="dialog"
                                aria-expanded="@IsPickerOpen(PlatoonPicker)"
                                aria-controls="platoon-panel">
                            <span>@GetPlatoonDaysOffLabel(_selection.PlatoonDaysOff)</span>
                            <span class="month-picker__chevron" aria-hidden="true">▾</span>
                        </button>
                        @if (IsPickerOpen(PlatoonPicker))
                        {
                            <div id="platoon-panel" class="month-picker__panel month-picker__panel--list month-picker__panel--attached" role="dialog" aria-label="Choose days off">
                                <div class="month-picker__grid month-picker__grid--list">
                                    @foreach (var option in _platoonDaysOffOptions)
                                    {
                                        var isSelected = _selection.PlatoonDaysOff == option.Value;
                                        <button type="button"
                                                class="month-picker__month @(isSelected ? "is-selected" : "")"
                                                @onclick="() => SelectPlatoonDaysOff(option.Value)"
                                                aria-label="@option.Label">
                                            @option.Label
                                        </button>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
            else if (_selection.ScheduleType == ScheduleType.RotatingFourByTen)
            {
                <div class="selection-field">
                    <label class="form-label" for="rotating-days">Starting Days Off</label>
                    <div class="month-picker">
                        <button id="rotating-days"
                                type="button"
                                class="form-control month-picker__toggle @(IsPickerOpen(RotatingPicker) ? "is-open" : "")"
                                @onclick="() => TogglePicker(RotatingPicker)"
                                aria-haspopup="dialog"
                                aria-expanded="@IsPickerOpen(RotatingPicker)"
                                aria-controls="rotating-panel">
                            <span>@GetRotatingOffLabel(_selection.RotatingOffStartDay)</span>
                            <span class="month-picker__chevron" aria-hidden="true">▾</span>
                        </button>
                        @if (IsPickerOpen(RotatingPicker))
                        {
                            <div id="rotating-panel" class="month-picker__panel month-picker__panel--list month-picker__panel--attached" role="dialog" aria-label="Choose starting days off">
                                <div class="month-picker__grid month-picker__grid--list">
                                    @foreach (var day in _rotatingOffDays)
                                    {
                                        var isSelected = _selection.RotatingOffStartDay == day;
                                        <button type="button"
                                                class="month-picker__month @(isSelected ? "is-selected" : "")"
                                                @onclick="() => SelectRotatingOffStartDay(day)"
                                                aria-label="@GetRotatingOffLabel(day)">
                                            @GetRotatingOffLabel(day)
                                        </button>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>

        <div class="selection-actions">
            <button class="btn btn-primary save-btn" type="button" @onclick="SaveSelection">Save Selection</button>
            @if (!string.IsNullOrWhiteSpace(_statusMessage))
            {
                <span class="status-msg">@_statusMessage</span>
            }
        </div>
    </div>
</div>

@if (_yearSchedule.Count > 0)
{
    @if (_previewMode == PreviewMode.Table)
    {
        <div class="app-card p-4 mb-4">
            <div class="schedule-year-header mb-3">
                <h5 class="card-title mb-0">Year View</h5>
                <div class="schedule-year-actions">
                    <div class="btn-group" role="group" aria-label="Schedule view">
                        <button type="button"
                                class="btn btn-sm btn-outline-secondary @(_previewMode == PreviewMode.Table ? "active" : "")"
                                aria-pressed="@(_previewMode == PreviewMode.Table)"
                                @onclick="() => SetPreviewModeAsync(PreviewMode.Table)">
                            Table
                        </button>
                        <button type="button"
                                class="btn btn-sm btn-outline-secondary @(_previewMode == PreviewMode.Calendar ? "active" : "")"
                                aria-pressed="@(_previewMode == PreviewMode.Calendar)"
                                @onclick="() => SetPreviewModeAsync(PreviewMode.Calendar)">
                            Calendar
                        </button>
                    </div>

                    <button type="button"
                            class="btn btn-sm btn-outline-secondary"
                            @onclick="ToggleYearCollapse"
                            aria-expanded="@(!_isYearCollapsed)">
                        @(_isYearCollapsed ? "Show all months" : "Show fewer months")
                    </button>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-sm align-middle schedule-table app-table">
                    <thead>
                        <tr>
                            <th>Week of</th>
                            @foreach (var name in _dayNames)
                            {
                                <th>@name[..3]</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var week in VisibleWeeks)
                        {
                            <tr>
                                <td class="text-nowrap fw-bold text-muted">@week.WeekStart.ToString("MMM dd")</td>
                                @foreach (var day in week.Days)
                                {
                                    <td class="p-2">
                                        <div class="small text-muted mb-1">@day.Date.ToString("MM/dd")</div>
                                        @if (!day.IsActive)
                                        {
                                            <span class="status-chip status-chip--empty">-</span>
                                        }
                                        else if (day.IsWorkDay)
                                        {
                                            <span class="status-chip status-chip--work">WK</span>
                                        }
                                        else
                                        {
                                            <span class="status-chip status-chip--off">Off</span>
                                        }
                                    </td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
    else
    {
        <div class="app-card p-4 mb-4">
            <div class="schedule-year-header mb-3">
                <h5 class="card-title mb-0">Calendar View</h5>
                <div class="schedule-year-actions">
                    <div class="btn-group" role="group" aria-label="Schedule view">
                        <button type="button"
                                class="btn btn-sm btn-outline-secondary @(_previewMode == PreviewMode.Table ? "active" : "")"
                                aria-pressed="@(_previewMode == PreviewMode.Table)"
                                @onclick="() => SetPreviewModeAsync(PreviewMode.Table)">
                            Table
                        </button>
                        <button type="button"
                                class="btn btn-sm btn-outline-secondary @(_previewMode == PreviewMode.Calendar ? "active" : "")"
                                aria-pressed="@(_previewMode == PreviewMode.Calendar)"
                                @onclick="() => SetPreviewModeAsync(PreviewMode.Calendar)">
                            Calendar
                        </button>
                    </div>

                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary" @onclick="() => ShiftCalendarStart(-1)" aria-label="Previous month">‹</button>
                        <button type="button" class="btn btn-sm btn-outline-secondary" @onclick="() => ShiftCalendarStart(1)" aria-label="Next month">›</button>
                    </div>
                </div>
            </div>

            <div class="calendar-3up">
                @foreach (var monthStart in VisibleCalendarMonths)
                {
                    <div class="calendar-month">
                        <div class="calendar-month__title">@monthStart.ToString("MMMM yyyy")</div>
                        <div class="calendar-grid">
                            @foreach (var name in _dayNames)
                            {
                                <div class="calendar-cell calendar-cell--head">@name[..1]</div>
                            }

                            @foreach (var date in GetCalendarGridDates(monthStart))
                            {
                                var inMonth = date.Month == monthStart.Month && date.Year == monthStart.Year;
                                var day = GetDayForDate(date);
                                var statusClass = day?.IsWorkDay == true ? "calendar-cell--work" : (day is not null && !day.IsWorkDay && day.IsActive ? "calendar-cell--off" : "");

                                <div class="calendar-cell @(inMonth ? "" : "calendar-cell--muted") @statusClass">
                                    <div class="calendar-date">@date.Day</div>
                                    @if (day is null || !day.IsActive)
                                    {
                                        <span class="status-chip status-chip--empty">-</span>
                                    }
                                    else if (day.IsWorkDay)
                                    {
                                        <span class="status-chip status-chip--work">WK</span>
                                    }
                                    else
                                    {
                                        <span class="status-chip status-chip--off">Off</span>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>
        </div>
    }
}

@code {
    private static readonly string[] _dayNames =
    {
        "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
    };

    private readonly ScheduleSelectionModel _selection = new();
    private readonly RotatingOffStartDay[] _rotatingOffDays = Enum.GetValues<RotatingOffStartDay>();
    private IReadOnlyList<WeekSchedule> _yearSchedule = Array.Empty<WeekSchedule>();
    private string? _statusMessage;
    private bool _isMonthPickerOpen;
    private int _visibleYear;
    private string? _openPicker;
    private bool _isYearCollapsed = true;
    private PreviewMode _previewMode = PreviewMode.Table;
    private DateTime _calendarStartMonth = new(DateTime.Today.Year, DateTime.Today.Month, 1);
    private static readonly string[] _monthShortNames =
        CultureInfo.CurrentCulture.DateTimeFormat.AbbreviatedMonthNames[..12];
    private static readonly string[] _monthFullNames =
        CultureInfo.CurrentCulture.DateTimeFormat.MonthNames[..12];
    private static readonly (ScheduleType Value, string Label)[] _scheduleOptions =
    [
        (ScheduleType.FiveByEight, "5x8"),
        (ScheduleType.PlatoonTen, "Platoon 10s"),
        (ScheduleType.RotatingFourByTen, "Rotating 4x10")
    ];
    private static readonly (ShiftType Value, string Label)[] _shiftOptions =
    [
        (ShiftType.Day, "Day"),
        (ShiftType.Swing, "Swing"),
        (ShiftType.Mid, "Mid")
    ];
    private static readonly (PlatoonDaysOffOption Value, string Label)[] _platoonDaysOffOptions =
    [
        (PlatoonDaysOffOption.MonTue, "Mon/Tue"),
        (PlatoonDaysOffOption.ThuFri, "Thu/Fri")
    ];
    private const string SchedulePicker = "schedule";
    private const string ShiftPicker = "shift";
    private const string PlatoonPicker = "platoon";
    private const string RotatingPicker = "rotating";

    private IReadOnlyList<WeekSchedule> VisibleWeeks => _isYearCollapsed
        ? GetCollapsedWeeks()
        : _yearSchedule;

    private IReadOnlyList<DateTime> VisibleCalendarMonths =>
    [
        _calendarStartMonth,
        _calendarStartMonth.AddMonths(1),
        _calendarStartMonth.AddMonths(2)
    ];

    protected override void OnInitialized()
    {
        _ = InitializeAsync();
    }

    private async Task InitializeAsync()
    {
        var userId = await Auth.GetCurrentUserIdAsync();
        ScheduleSelection selection;
        if (userId is Guid id)
        {
            selection = await ScheduleService.GetSelectionForUserAsync(id) ?? ScheduleService.GetSelection();
        }
        else
        {
            selection = ScheduleService.GetSelection();
        }

        _selection.ScheduleType = selection.ScheduleType;
        _selection.ShiftType = selection.ShiftType;
        _selection.StartMonth = new DateTime(selection.StartDate.Year, selection.StartDate.Month, 1);
        _selection.PlatoonDaysOff = selection.PlatoonDaysOff;
        _selection.RotatingOffStartDay = selection.RotatingOffStartDay;
        _visibleYear = _selection.StartMonth.Year;
        _calendarStartMonth = _selection.StartMonth;

        if (userId is Guid viewUserId)
        {
            var preferred = await ScheduleService.GetPreferredScheduleViewForUserAsync(viewUserId);
            _previewMode = preferred?.Equals("calendar", StringComparison.OrdinalIgnoreCase) == true
                ? PreviewMode.Calendar
                : PreviewMode.Table;
        }

        UpdatePreview();
        await InvokeAsync(StateHasChanged);
    }

    private async Task SaveSelection()
    {
        var selection = new ScheduleSelection(
            _selection.ScheduleType,
            _selection.ShiftType,
            GetStartDate(),
            _selection.PlatoonDaysOff,
            _selection.RotatingOffStartDay);

        ScheduleService.UpdateSelection(selection);

        var userId = await Auth.GetCurrentUserIdAsync();
        if (userId is Guid id)
        {
            await ScheduleService.SaveSelectionForUserAsync(id, selection);
            _statusMessage = "Schedule saved.";
        }
        else
        {
            _statusMessage = "Log in to save your schedule.";
        }

        UpdatePreview();
    }

    private async Task SetPreviewModeAsync(PreviewMode mode)
    {
        _previewMode = mode;

        var userId = await Auth.GetCurrentUserIdAsync();
        if (userId is Guid id)
        {
            await ScheduleService.SavePreferredScheduleViewForUserAsync(id, mode == PreviewMode.Calendar ? "calendar" : "table");
        }
    }

    private void ToggleMonthPicker()
    {
        _openPicker = null;
        _isMonthPickerOpen = !_isMonthPickerOpen;
    }

    private void CloseAllPickers()
    {
        _isMonthPickerOpen = false;
        _openPicker = null;
    }

    private void TogglePicker(string picker)
    {
        _isMonthPickerOpen = false;
        _openPicker = _openPicker == picker ? null : picker;
    }

    private bool IsPickerOpen(string picker)
    {
        return _openPicker == picker;
    }

    private void SelectSchedule(ScheduleType scheduleType)
    {
        _selection.ScheduleType = scheduleType;
        _openPicker = null;
        UpdatePreview();
    }

    private void SelectShift(ShiftType shiftType)
    {
        _selection.ShiftType = shiftType;
        _openPicker = null;
        UpdatePreview();
    }

    private void SelectPlatoonDaysOff(PlatoonDaysOffOption option)
    {
        _selection.PlatoonDaysOff = option;
        _openPicker = null;
        UpdatePreview();
    }

    private void SelectRotatingOffStartDay(RotatingOffStartDay day)
    {
        _selection.RotatingOffStartDay = day;
        _openPicker = null;
        UpdatePreview();
    }

    private void ChangeYear(int delta)
    {
        _visibleYear += delta;
    }

    private void SelectMonth(int month)
    {
        _selection.StartMonth = new DateTime(_visibleYear, month, 1);
        _isMonthPickerOpen = false;
        _calendarStartMonth = _selection.StartMonth;
        UpdatePreview();
    }

    private void SelectThisMonth()
    {
        var today = DateTime.Today;
        _visibleYear = today.Year;
        _selection.StartMonth = new DateTime(today.Year, today.Month, 1);
        _isMonthPickerOpen = false;
        _calendarStartMonth = _selection.StartMonth;
        UpdatePreview();
    }

    private static string GetScheduleLabel(ScheduleType scheduleType)
    {
        return scheduleType switch
        {
            ScheduleType.FiveByEight => "5x8",
            ScheduleType.PlatoonTen => "Platoon 10s",
            ScheduleType.RotatingFourByTen => "Rotating 4x10",
            _ => scheduleType.ToString()
        };
    }

    private static string GetShiftLabel(ShiftType shiftType)
    {
        return shiftType switch
        {
            ShiftType.Day => "Day",
            ShiftType.Swing => "Swing",
            ShiftType.Mid => "Mid",
            _ => shiftType.ToString()
        };
    }

    private static string GetPlatoonDaysOffLabel(PlatoonDaysOffOption option)
    {
        return option switch
        {
            PlatoonDaysOffOption.MonTue => "Mon/Tue",
            PlatoonDaysOffOption.ThuFri => "Thu/Fri",
            _ => option.ToString()
        };
    }

    private void UpdatePreview()
    {
        ScheduleService.UpdateSelection(new ScheduleSelection(
            _selection.ScheduleType,
            _selection.ShiftType,
            GetStartDate(),
            _selection.PlatoonDaysOff,
            _selection.RotatingOffStartDay));

        _yearSchedule = ScheduleService.BuildYearSchedule(GetStartDate());
        _statusMessage = null;
    }

    private void ToggleYearCollapse()
    {
        _isYearCollapsed = !_isYearCollapsed;
    }

    private IReadOnlyList<WeekSchedule> GetCollapsedWeeks()
    {
        if (_yearSchedule.Count == 0)
        {
            return Array.Empty<WeekSchedule>();
        }

        var firstVisibleMonth = _selection.StartMonth;
        var lastVisibleMonth = firstVisibleMonth.AddMonths(3);
        var start = new DateOnly(firstVisibleMonth.Year, firstVisibleMonth.Month, 1);
        var endExclusive = new DateOnly(lastVisibleMonth.Year, lastVisibleMonth.Month, 1).AddMonths(1);
        return _yearSchedule.Where(w => w.WeekStart < endExclusive && w.WeekStart.AddDays(7) > start).ToList();
    }

    private void ShiftCalendarStart(int deltaMonths)
    {
        _calendarStartMonth = _calendarStartMonth.AddMonths(deltaMonths);
    }

    private ScheduleDay? GetDayForDate(DateOnly date)
    {
        if (_yearSchedule.Count == 0)
        {
            return null;
        }

        foreach (var week in _yearSchedule)
        {
            for (var i = 0; i < week.Days.Count; i++)
            {
                var day = week.Days[i];
                if (day.Date == date)
                {
                    return day;
                }
            }
        }

        return null;
    }

    private static IReadOnlyList<DateOnly> GetCalendarGridDates(DateTime monthStart)
    {
        var start = new DateOnly(monthStart.Year, monthStart.Month, 1);
        var endInclusive = start.AddMonths(1).AddDays(-1);

        var first = GetWeekStart(start);
        var last = GetWeekStart(endInclusive).AddDays(6);

        var dates = new List<DateOnly>();
        var d = first;
        while (d <= last)
        {
            dates.Add(d);
            d = d.AddDays(1);
        }

        return dates;
    }

    private static DateOnly GetWeekStart(DateOnly date)
    {
        var offset = (((int)date.DayOfWeek + 6) % 7 + 7) % 7;
        return date.AddDays(-offset);
    }

    private enum PreviewMode
    {
        Table,
        Calendar
    }

    private DateOnly GetStartDate()
    {
        return new DateOnly(_selection.StartMonth.Year, _selection.StartMonth.Month, 1);
    }

    private static string GetRotatingOffLabel(RotatingOffStartDay startDay)
    {
        var startIndex = GetDayIndex(startDay);
        var midIndex = (startIndex + 1) % 7;
        var endIndex = (startIndex + 2) % 7;
        return $"{_dayNames[startIndex][..3]}/{_dayNames[midIndex][..3]}/{_dayNames[endIndex][..3]}";
    }

    private sealed class ScheduleSelectionModel
    {
        [Required]
        public ScheduleType ScheduleType { get; set; } = ScheduleType.FiveByEight;

        [Required]
        public ShiftType ShiftType { get; set; } = ShiftType.Day;

        [Required]
        public DateTime StartMonth { get; set; } = new(DateTime.Today.Year, DateTime.Today.Month, 1);

        [Required]
        public PlatoonDaysOffOption PlatoonDaysOff { get; set; } = PlatoonDaysOffOption.MonTue;

        [Required]
        public RotatingOffStartDay RotatingOffStartDay { get; set; } = RotatingOffStartDay.Monday;
    }

    private static int GetDayIndex(RotatingOffStartDay day)
    {
        return day switch
        {
            RotatingOffStartDay.Monday => 0,
            RotatingOffStartDay.Tuesday => 1,
            RotatingOffStartDay.Wednesday => 2,
            RotatingOffStartDay.Thursday => 3,
            RotatingOffStartDay.Friday => 4,
            RotatingOffStartDay.Saturday => 5,
            RotatingOffStartDay.Sunday => 6,
            _ => 0
        };
    }
}
